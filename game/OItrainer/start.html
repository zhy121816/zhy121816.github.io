<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å¼€å§‹ - zhanghy16çš„ä¸»é¡µ</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* å¯åŠ¨è’™ç‰ˆæ ·å¼ */
    .oi-start-mask{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:9999;
      background:linear-gradient(180deg, rgba(10,25,47,0.95), rgba(22,32,54,0.95)), url('assets/start-bg.jpg') center/cover no-repeat;
      color: #fff;
      padding:20px;
      box-sizing:border-box;
      flex-direction:column;
    }
    .oi-start-mask .mask-content{
      max-width:880px;
      text-align:center;
      backdrop-filter: blur(2px);
    }
    .oi-start-mask h2{
      font-size:34px;
      margin:0 0 12px 0;
      text-shadow:0 2px 8px rgba(0,0,0,0.6);
    }
    .oi-start-mask p{
      margin:0 0 18px 0;
      color:rgba(255,255,255,0.9);
      font-size:16px;
    }
    .oi-start-mask .mask-actions{margin-top:8px}
    .oi-start-mask .btn{min-width:150px;padding:10px 16px;font-size:16px;border-radius:6px}
    .oi-start-mask .btn-start{background:#38a169;border:none;color:white}
    .oi-start-mask .btn-skip{background:transparent;border:1px solid rgba(255,255,255,0.2);color:white;margin-left:8px}
    .disclaimer{
      font-size:12px;
      color: rgba(51,51,51,0.9);
      margin-top:12px;
      line-height:1.6;
      text-align:left;
      background: rgba(240,240,240,0.9);
      padding:10px 12px;
      border-radius:8px;
      max-width:960px;
      margin-left:auto;
      margin-right:auto;
      box-sizing:border-box;
      opacity:0.98;
    }
  </style>
<!-- Clarity tracking removed -->
  <!-- Cloudflare Web Analytics loader (conditional: only load if page load time <= 2s) -->
  <script>
    (function(){
      function injectCF(){
        var s = document.createElement('script');
        s.defer = true;
        s.src = 'https://static.cloudflareinsights.com/beacon.min.js';
        s.setAttribute('data-cf-beacon', '{"token": "cd3db41765ea4c17be0930b3f94e3c3a"}');
        document.head.appendChild(s);
      }
      function shouldLoad(){
        try{
          var start = (performance.timing && performance.timing.navigationStart) || 0;
          var elapsed = performance.now ? performance.now() : (Date.now() - start);
          return elapsed <= 2000;
        }catch(e){ return false; }
      }
      document.addEventListener('DOMContentLoaded', function(){ if(shouldLoad()) injectCF(); });
    })();
  </script>
</head>
<body>
  <!-- å¯åŠ¨è’™ç‰ˆï¼šåŠ è½½æ—¶å®Œå…¨è¦†ç›–é¡µé¢ï¼Œç‚¹å‡»å¼€å§‹åéšè— -->
  <div id="oiStartMask" class="oi-start-mask" role="dialog" aria-label="æ¸¸æˆå¼€å§‹">
    <div class="mask-content">
      <h2>OI æ•™ç»ƒæ¨¡æ‹Ÿå™¨</h2>
      <h3 class="oi-start-subtitle" style="font-size:16px;margin:6px 0 12px;color:rgba(255,255,255,0.95);font-weight:400;line-height:1.9;"></h3>
        é«˜äºŒNOIPï¼Œä½ è¢«é»„ç´«é»‘é»‘åˆ›é£åŸåœ°AFOã€‚<br><br>
        ä¸€è§‰é†’æ¥ï¼Œä½ å‘ç°ä½ ååœ¨æœºæˆ¿å‰ï¼Œæˆä¸ºäº†ä½ ä»¬å­¦æ ¡ä¿¡æ¯å­¦ç«èµ›çš„æ€»æ•™ç»ƒã€‚<br><br>
        å›æƒ³èµ·ä¹‹å‰æ„é€ é¢˜æ²¡checkerï¼Œæ¨¡æ‹Ÿèµ›æ²¡å¤§æ ·ä¾‹ï¼Œä¸€ä¸ªæœˆæ²¡æœ‰åŠå¤©å‡æœŸçš„è®­ç»ƒç”Ÿæ´»ã€‚<br><br>
        ä½ å†³å®šè¦æ”¹å˜è¿™ä¸€åˆ‡ã€‚
  </h3>
  <p></p>
      <div class="mask-actions">
       <button id="oiMaskSkipBtn" class="btn btn-skip">è¿›å…¥æ¸¸æˆ</button>
      </div>
    </div>
  </div>
<div class="container">
  <header>
    <h1>OI æ•™ç»ƒæ¨¡æ‹Ÿå™¨ â€” å¼€å§‹</h1>
  </header>
  <div class="panel">
    <h3>æ–°æ¸¸æˆè®¾ç½®</h3>
    
    <!-- éš¾åº¦å’Œæ¨¡å¼å¹¶æ’å¸ƒå±€ -->
    <div style="display:flex;gap:16px;margin-bottom:10px;flex-wrap:wrap;">
      <div style="flex:1;min-width:280px;">
        <label class="block">é€‰æ‹©éš¾åº¦</label>
        <!-- å¹³é“ºå¼éš¾åº¦é€‰æ‹©å¡ï¼ˆä¿ç•™éšè— select ç”¨äºå…¼å®¹æ—§é€»è¾‘ï¼‰ -->
        <select id="start-diff" style="display:none">
          <option value="1">ç®€å• - é€‚åˆåˆæ¬¡ä½“éªŒçš„äºº</option>
          <option value="2" selected>æ™®é€š - æ ‡å‡†æ¸¸æˆä½“éªŒ</option>
          <option value="3">å›°éš¾ - é€‚åˆå¯»æ±‚æŒ‘æˆ˜çš„äºº</option>
        </select>
        <div id="start-diff-grid" class="diff-grid" style="display:flex;gap:10px;margin-top:8px"></div>
        <div id="diff-note" class="small muted" style="margin-top:6px"></div>
      </div>

      <div style="flex:1;min-width:280px;">
        <label class="block">æ¸¸æˆæ¨¡å¼</label>
        <div id="start-mode-grid" class="mode-grid" style="display:flex;gap:10px;margin-top:8px;">
          <div class="option-card mode-card selected" data-val="simplified" style="flex:1;cursor:pointer;padding:10px 12px;border:1px solid #e6e6e6;border-radius:8px;text-align:center;">
            <div style="font-weight:600;margin-bottom:6px">ç®€åŒ–æ¨¡å¼</div>
            <div class="small muted">å‹ç¼©æ—¶é—´è½´ï¼Œç®€åŒ–å†³ç­–ï¼ŒèŠ‚å¥è¾ƒå¿«</div>
          </div>
          <div class="option-card mode-card" data-val="realistic" style="flex:1;cursor:not-allowed;padding:10px 12px;border:1px solid #e6e6e6;border-radius:8px;text-align:center;opacity:0.5;">
            <div style="font-weight:600;margin-bottom:6px">çœŸå®æ¨¡å¼</div>
            <div class="small muted">çœŸå®æ—¶é—´å®‰æ’ï¼ŒèŠ‚å¥ç¼“æ…¢</div>
            <div class="small" style="color:#999;font-style:italic;margin-top:4px;">(å³å°†åˆ°æ¥)</div>
          </div>
        </div>
        <input type="hidden" id="start-mode" value="simplified" />
      </div>
    </div>

    <label class="block" style="margin-top:10px">é€‰æ‹©çœä»½</label>
    <div class="small muted" style="margin-bottom:6px">ä¸åŒçœä»½å½±å“åˆå§‹ç»è´¹å’Œè®­ç»ƒè´¨é‡ã€‚<strong>å¼ºçœ</strong>èµ„æºä¸°å¯Œ<strong>å¼±çœ</strong>å…·æœ‰æŒ‘æˆ˜æ€§ã€‚</div>
    <div id="start-prov-grid" class="prov-grid"></div>

    <label class="block" style="margin-top:10px">å­¦ç”Ÿäººæ•° (3-10)</label>
    <div class="small muted" style="margin-bottom:6px">æ›´å¤šå­¦ç”Ÿæ„å‘³ç€æ›´å¤šæœºé‡ï¼Œä¹Ÿä¼šå¸¦æ¥æ›´å¤šçš„ç»è´¹å¼€æ”¯</div>
    <input id="start-stu" type="number" min="3" max="10" value="5" />

    <!-- åŸæ‹›ç”Ÿ/å­¦å‰åŸ¹å…» UI å·²ç§»é™¤ã€‚ä¸‹é¢ä»…å±•ç¤ºå¯ç”¨å¤©èµ‹åˆ—è¡¨ -->
    <div class="sub-panel collapsible collapsed" id="talent-only-panel" style="margin-top:12px">
      <h4>æ¸¸æˆæ ¸å¿ƒæ¦‚å¿µ</h4>
      <div class="small muted" style="line-height:1.6;margin-bottom:10px">
        <p><strong>ç›®æ ‡</strong>ï¼šå¸¦é¢†å­¦ç”Ÿåœ¨ä¸¤ä¸ªèµ›å­£å†…å†²å‡»NOIé‡‘ç‰Œï¼Œå…¥é€‰å›½å®¶é›†è®­é˜Ÿï¼Œè¿›å†›IOI</p>
        <p><strong>å­¦ç”Ÿå±æ€§</strong>ï¼šæ€ç»´ã€ç¼–ç¨‹ã€å¿ƒç†ä¸‰é¡¹åŸºç¡€èƒ½åŠ› + äº”å¤§çŸ¥è¯†ç‚¹ï¼ˆæ•°æ®ç»“æ„ã€å›¾è®ºã€å­—ç¬¦ä¸²ã€æ•°å­¦ã€DPï¼‰</p>
        <p><strong>ç»è´¹ç®¡ç†</strong>ï¼šå‡çº§è®¾æ–½ã€å‚åŠ é›†è®­éƒ½éœ€è¦ç»è´¹ï¼Œéœ€åˆç†è§„åˆ’</p>
        <p><strong>å‹åŠ›ç³»ç»Ÿ</strong>ï¼šé«˜å‹è®­ç»ƒä¼šå¢åŠ å‹åŠ›ï¼Œå‹åŠ›è¿‡é«˜å¯èƒ½å¯¼è‡´é€€é˜Ÿ</p>
        <p><strong>æ¯”èµ›é“¾</strong>ï¼šCSP-S1 â†’ CSP-S2 â†’ NOIP â†’ çœé€‰ â†’ NOIï¼Œå¿…é¡»é€šè¿‡å‰ä¸€åœºæ‰èƒ½å‚åŠ ä¸‹ä¸€åœº</p>
      </div>
  <h4 class="collapsible-head" style="margin-top:16px">å¤©èµ‹é¢„è§ˆ</h4>
  <div class="small muted" style="margin-bottom:6px">å­¦ç”Ÿåœ¨è®­ç»ƒä¸­æœ‰æ¦‚ç‡è·å¾—å¤©èµ‹ï¼Œå¤©èµ‹ä¼šå½±å“æ¯”èµ›è¡¨ç°å’Œè®­ç»ƒæ•ˆæœ</div>
      <div id="talent-grid" class="talent-grid"></div>
      <!-- ä¿ç•™éšè— select ä»¥ä¾¿ä¸æ—§é€»è¾‘å…¼å®¹ï¼ˆä»…ç”¨äºå­˜å‚¨/è¡¨å•åŒæ­¥ï¼‰ -->
      <select id="train-talent" style="display:none"></select>
    </div>

    <div class="modal-actions" style="margin-top:12px">
      <button class="btn btn-ghost" id="start-help">æŸ¥çœ‹è¯¦ç»†å¸®åŠ©</button>
      <button class="btn" id="daily-challenge-btn" style="background:#667eea;color:white;">ğŸ“… ä»Šæ—¥æŒ‘æˆ˜</button>
      <button class="btn" id="start-button">å¼€å§‹æ¸¸æˆ ğŸš€</button>
    </div>
  </div>
</div>

<script src="lib/chinese-convert.js"></script>
<script src="events.js"></script>
<script src="lib/constants.js"></script>
<script src="lib/utils.js"></script>
<script src="lib/models.js"></script>
<script src="lib/talent.js"></script>
<script src="game.js"></script>
<script src="render.js"></script>
<script src="debug.js"></script>
<script>

  // ç§»é™¤å¯¹æ‹›ç”Ÿ/å­¦å‰åŸ¹å…»çŠ¶æ€çš„ç»´æŠ¤ï¼›ä»…æä¾›æ¸²æŸ“å¤©èµ‹ç½‘æ ¼çš„åŠŸèƒ½
  function renderTalentGrid(){
    const grid = document.getElementById('talent-grid');
    const hiddenSelect = document.getElementById('train-talent');
    if(!grid || !hiddenSelect) return;
    grid.innerHTML = '';
    hiddenSelect.innerHTML = '';
    if(typeof window === 'undefined' || !window.TalentManager) return;
    const talents = window.TalentManager.getRegistered();
    talents.forEach(name => {
      const info = window.TalentManager.getTalentInfo(name) || {};
      // populate hidden select
      const opt = document.createElement('option'); opt.value = name; opt.textContent = name; hiddenSelect.appendChild(opt);

      // create card
      const card = document.createElement('div'); card.className = 'talent-card'; card.dataset.val = name;
      const top = document.createElement('div');
      const dot = document.createElement('span'); dot.className = 'color-dot'; dot.style.background = (info.color || '#2b6cb0');
      const title = document.createElement('span'); title.className = 'title'; title.textContent = name;
      top.appendChild(dot); top.appendChild(title);
      const desc = document.createElement('div'); desc.className = 'desc'; desc.textContent = info.description || '';
      card.appendChild(top); card.appendChild(desc);

      card.addEventListener('click', ()=>{
        // å•é€‰é«˜äº®ï¼Œä»…ç”¨äºå±•ç¤º/é€‰æ‹©
        grid.querySelectorAll('.talent-card.selected').forEach(c=>c.classList.remove('selected'));
        card.classList.add('selected');
        hiddenSelect.value = name;
      });

      grid.appendChild(card);
    });
  }

  // é¡µé¢åŠ è½½åæ¸²æŸ“å¤©èµ‹åˆ—è¡¨ï¼šä¼˜å…ˆåœ¨ TalentManager å·²æ³¨å†Œå¤©èµ‹æ—¶ç«‹å³æ¸²æŸ“ï¼Œ
  // å¦åˆ™åœ¨ window.load åå†æ¸²æŸ“ï¼Œå¹¶æä¾›çŸ­è½®è¯¢ä½œä¸ºå›é€€ï¼Œç¡®ä¿åœ¨ registerDefaultTalents ä¹‹åæ¸²æŸ“ã€‚
  function ensureRenderTalentGrid(){
    try{
      if(typeof window !== 'undefined' && window.TalentManager && typeof window.TalentManager.getRegistered === 'function'){
        const reg = window.TalentManager.getRegistered() || [];
        if(reg.length > 0){ renderTalentGrid(); return true; }
      }
    }catch(e){}
    return false;
  }

  if(!ensureRenderTalentGrid()){
    // åœ¨ load äº‹ä»¶åå†å°è¯•ï¼ˆscript.js åœ¨ window.onload ä¸­ä¼šè°ƒç”¨ registerDefaultTalentsï¼‰
    window.addEventListener('load', ()=>{ setTimeout(()=>{ renderTalentGrid(); }, 50); });

    // ä½œä¸ºé¢å¤–ä¿é™©ï¼ŒçŸ­è½®è¯¢ç›´åˆ° TalentManager å‡ºç°æˆ–è¶…æ—¶
    let _tg_tries = 0;
    const _tg_interval = setInterval(()=>{
      _tg_tries += 1;
      if(ensureRenderTalentGrid() || _tg_tries > 12) clearInterval(_tg_interval);
    }, 200);
  }

    // Render difficulty as tiled options and sync with hidden select (#start-diff)
    function renderDiffGrid(){
      const defs = [
        {v:1,label:'ç®€å•',desc:'é€‚åˆåˆæ¬¡ä½“éªŒçš„äºº'},
        {v:2,label:'æ™®é€š',desc:'æ ‡å‡†æ¸¸æˆä½“éªŒ'},
        {v:3,label:'ä¸“å®¶',desc:'é€‚åˆå¯»æ±‚æŒ‘æˆ˜çš„äºº'}
      ];
      const grid = document.getElementById('start-diff-grid');
      const hidden = document.getElementById('start-diff');
      const note = document.getElementById('diff-note');
      if(!grid || !hidden) return;
      grid.innerHTML = '';
      defs.forEach(d => {
        const card = document.createElement('div');
        card.className = 'option-card';
        card.dataset.val = d.v;
        card.style.cursor = 'pointer';
        card.style.padding = '10px 12px';
        card.style.border = '1px solid #e6e6e6';
        card.style.borderRadius = '8px';
        card.style.minWidth = '110px';
        card.style.textAlign = 'center';
        card.innerHTML = `<div style="font-weight:600;margin-bottom:6px">${d.label}</div><div class="small muted">${d.desc}</div>`;
        card.addEventListener('click', ()=>{
          grid.querySelectorAll('.option-card.selected').forEach(c=>c.classList.remove('selected'));
          card.classList.add('selected');
          // sync hidden select
          hidden.value = ''+d.v;
          // show note under grid
          if(note) note.textContent = d.label + ' â€” ' + d.desc;
        });
        grid.appendChild(card);
      });

      // mark initial selection based on select value
      const initial = hidden.value || '2';
      const chosen = grid.querySelector(`.option-card[data-val='${initial}']`);
      if(chosen) chosen.classList.add('selected');
      if(note){ const c = grid.querySelector('.option-card.selected'); note.textContent = c ? (c.querySelector('div').textContent + ' â€” ' + c.querySelector('.small').textContent) : ''; }
    }

    try{ renderDiffGrid(); }catch(e){ console.error('æ¸²æŸ“éš¾åº¦ç½‘æ ¼å¤±è´¥', e); }

  // æ¸²æŸ“æ¸¸æˆæ¨¡å¼é€‰æ‹©ç½‘æ ¼
  function renderModeGrid(){
    const grid = document.getElementById('start-mode-grid');
    const hidden = document.getElementById('start-mode');
    if(!grid || !hidden) return;
    
    const cards = grid.querySelectorAll('.mode-card');
    cards.forEach(card => {
      const val = card.dataset.val;
      
      // çœŸå®æ¨¡å¼æš‚æ—¶ç¦ç”¨ï¼Œåªæœ‰ç®€åŒ–æ¨¡å¼å¯é€‰
      if(val === 'realistic'){
        // å·²ç»åœ¨HTMLä¸­è®¾ç½®ä¸ºç¦ç”¨æ ·å¼
        return;
      }
      
      card.addEventListener('click', ()=>{
        // ç§»é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
        grid.querySelectorAll('.mode-card.selected').forEach(c=>c.classList.remove('selected'));
        // æ·»åŠ é€‰ä¸­çŠ¶æ€
        card.classList.add('selected');
        // åŒæ­¥åˆ°éšè—input
        hidden.value = val;
      });
    });
    
    // è®¾ç½®åˆå§‹é€‰ä¸­çŠ¶æ€ï¼ˆé»˜è®¤ç®€åŒ–æ¨¡å¼ï¼‰
    const initial = hidden.value || 'simplified';
    const chosen = grid.querySelector(`.mode-card[data-val='${initial}']`);
    if(chosen) chosen.classList.add('selected');
  }

    try{ renderDiffGrid(); }catch(e){ console.error('æ¸²æŸ“éš¾åº¦ç½‘æ ¼å¤±è´¥', e); }

  // æ¸²æŸ“æ¸¸æˆæ¨¡å¼é€‰æ‹©ç½‘æ ¼
  function renderModeGrid(){
    const grid = document.getElementById('start-mode-grid');
    const hidden = document.getElementById('start-mode');
    if(!grid || !hidden) return;
    
    const cards = grid.querySelectorAll('.mode-card');
    cards.forEach(card => {
      const val = card.dataset.val;
      
      // çœŸå®æ¨¡å¼æš‚æ—¶ç¦ç”¨ï¼Œåªæœ‰ç®€åŒ–æ¨¡å¼å¯é€‰
      if(val === 'realistic'){
        // å·²ç»åœ¨HTMLä¸­è®¾ç½®ä¸ºç¦ç”¨æ ·å¼
        return;
      }
      
      card.addEventListener('click', ()=>{
        // ç§»é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
        grid.querySelectorAll('.mode-card.selected').forEach(c=>c.classList.remove('selected'));
        // æ·»åŠ é€‰ä¸­çŠ¶æ€
        card.classList.add('selected');
        // åŒæ­¥åˆ°éšè—input
        hidden.value = val;
      });
    });
    
    // è®¾ç½®åˆå§‹é€‰ä¸­çŠ¶æ€ï¼ˆé»˜è®¤ç®€åŒ–æ¨¡å¼ï¼‰
    const initial = hidden.value || 'simplified';
    const chosen = grid.querySelector(`.mode-card[data-val='${initial}']`);
    if(chosen) chosen.classList.add('selected');
  }

  try{ renderModeGrid(); }catch(e){ console.error('æ¸²æŸ“æ¨¡å¼ç½‘æ ¼å¤±è´¥', e); }

  // render province buttons using PROVINCES from script.js (ä¿ç•™é¡µé¢å…¶ä»–åŠŸèƒ½çš„å…¼å®¹æ€§)
  if(typeof renderStartPageUI !== 'undefined'){
    renderStartPageUI && renderStartPageUI();
    setTimeout(() => {
      // æ·»åŠ çœä»½é€‰æ‹©ç›‘å¬å™¨ï¼Œå®ç°ç¹ç®€åˆ‡æ¢
      const provGrid = document.getElementById('start-prov-grid');
      if (provGrid && window.ChineseConverter) {
        provGrid.addEventListener('click', (e) => {
          const btn = e.target.closest('.prov-btn');
          if (btn) {
            const provId = parseInt(btn.dataset.val);
            // é¦™æ¸¯(14)å’Œæ¾³é—¨(25)ä½¿ç”¨ç¹ä½“ä¸­æ–‡
            if (provId === 14 || provId === 25) {
              window.ChineseConverter.setUseTraditionalChinese(true);
              // å»¶è¿Ÿè½¬æ¢ï¼Œç¡®ä¿DOMæ›´æ–°å®Œæˆ
              setTimeout(() => {
                window.ChineseConverter.convertPageToTraditional();
              }, 100);
            } else {
              // å…¶ä»–çœä»½ä½¿ç”¨ç®€ä½“ä¸­æ–‡ï¼Œéœ€è¦é‡æ–°åŠ è½½é¡µé¢
              const wasTraditional = window.ChineseConverter.shouldUseTraditionalChinese();
              if (wasTraditional) {
                window.ChineseConverter.setUseTraditionalChinese(false);
                window.location.reload();
              }
            }
          }
        });
      }
      
      // ä¿ç•™å¸®åŠ©ä¸å¼€å§‹æŒ‰é’®è¡Œä¸º
      document.getElementById('start-help').onclick = ()=>{ window.open('help.html','_blank'); };
      document.getElementById('start-button').onclick = ()=>{ startFromStartPage && startFromStartPage(); };
      
      // ä»Šæ—¥æŒ‘æˆ˜æŒ‰é’®
      document.getElementById('daily-challenge-btn').onclick = ()=>{ 
        if(typeof getDailyChallengeParams === 'function'){
          const params = getDailyChallengeParams();
          // æ˜¾ç¤ºä»Šæ—¥æŒ‘æˆ˜ä¿¡æ¯
          const provinceName = (typeof PROVINCES !== 'undefined' && PROVINCES[params.provinceId]) 
            ? PROVINCES[params.provinceId].name 
            : 'æœªçŸ¥çœä»½';
          
          if(confirm(`ğŸ“… ä»Šæ—¥æŒ‘æˆ˜ï¼ˆ${params.displayDate}ï¼‰\n\nçœä»½ï¼š${provinceName}\néš¾åº¦ï¼šæ™®é€š\nç§å­ï¼š${params.seed}\n\næ‰€æœ‰ç©å®¶ä»Šå¤©éƒ½å°†ä½¿ç”¨ç›¸åŒçš„åˆå§‹æ¡ä»¶ï¼\n\nç¡®è®¤å¼€å§‹ä»Šæ—¥æŒ‘æˆ˜ï¼Ÿ`)){
            // è®¾ç½®ä»Šæ—¥æŒ‘æˆ˜æ ‡è®°
            try {
              sessionStorage.setItem('oi_game_active_session', 'true');
              sessionStorage.setItem('oi_daily_challenge', 'true');
              sessionStorage.setItem('oi_daily_challenge_date', params.date);
            } catch(e) {
              console.error('æ— æ³•è®¾ç½® sessionStorage:', e);
            }
            
            // è·³è½¬åˆ°æ¸¸æˆé¡µé¢ï¼Œå¸¦ä¸Šä»Šæ—¥æŒ‘æˆ˜å‚æ•°
            const url = `game.html?new=1&daily=1&d=${params.difficulty}&p=${params.provinceId}&c=5&seed=${params.seed}`;
            window.location.href = url;
          }
        } else {
          alert('ä»Šæ—¥æŒ‘æˆ˜åŠŸèƒ½åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
        }
      };
    }, 100);
  }

    // åˆå§‹åŒ–å¯æŠ˜å é¢æ¿ï¼šé»˜è®¤æŠ˜å å¯¹ç‚¹æ‹›ç”Ÿä¸å­¦å‰åŸ¹å…»ï¼Œç‚¹å‡»æ ‡é¢˜åˆ‡æ¢
  (function(){
    function togglePanel(panel, expand){
      if(expand){
        panel.classList.remove('collapsed');
        panel.classList.add('expanded');
      } else {
        panel.classList.remove('expanded');
        panel.classList.add('collapsed');
      }
    }

    document.querySelectorAll('.sub-panel.collapsible').forEach(panel => {
      const head = panel.querySelector('.collapsible-head');
      // ensure initial state: keep collapsed if class present
      if(panel.classList.contains('collapsed')){
        togglePanel(panel, false);
      } else {
        togglePanel(panel, true);
      }

      head && head.addEventListener('click', ()=>{
        const isCollapsed = panel.classList.contains('collapsed');
        togglePanel(panel, isCollapsed);

        // å¦‚æœå±•å¼€ï¼Œå°è¯•æ¸²æŸ“é¢æ¿å†…çš„å»¶è¿Ÿå†…å®¹ï¼ˆä¾‹å¦‚å¤©èµ‹ç½‘æ ¼ï¼‰
        try{
          if(!isCollapsed){
            // å¦‚æœé¢æ¿åŒ…å«å¤©èµ‹ç½‘æ ¼ï¼Œåˆ™æ¸²æŸ“
            if(panel.querySelector && panel.querySelector('#talent-grid')){
              if(typeof renderTalentGrid === 'function') renderTalentGrid();
            }
            // å…¼å®¹æ—§çš„ train-panel è¡Œä¸º
            if(panel.id === 'train-panel'){
              if(typeof populateTalentSelect === 'function') try{ populateTalentSelect(); }catch(e){}
            }
          }
        }catch(e){}
      });
    });
  })();
</script>
<script>
  (function(){
    // ç­‰å¾… DOM å°±ç»ªï¼ˆé¡µé¢è„šæœ¬å·²åŠ è½½ï¼‰
    function hideMask(){
      try{
        const mask = document.getElementById('oiStartMask');
        if(!mask) return;
        mask.style.transition = 'opacity 220ms ease';
        mask.style.opacity = '0';
        setTimeout(()=>{ mask.parentNode && mask.parentNode.removeChild(mask); }, 260);
        // è®°å½•ç”¨æˆ·å·²ç»å…³é—­è¿‡è’™ç‰ˆ
        try{
          sessionStorage.setItem('oi_start_mask_dismissed', 'true');
        }catch(e){}
      }catch(e){ console.error('éšè—å¯åŠ¨è’™ç‰ˆå¤±è´¥', e); }
    }

    window.addEventListener('load', ()=>{
      // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç»å…³é—­è¿‡è’™ç‰ˆ
      try{
        const dismissed = sessionStorage.getItem('oi_start_mask_dismissed') === 'true';
        if(dismissed){
          // ç›´æ¥éšè—è’™ç‰ˆï¼Œä¸æ˜¾ç¤ºåŠ¨ç”»
          const mask = document.getElementById('oiStartMask');
          if(mask){
            mask.style.display = 'none';
          }
          return;
        }
      }catch(e){}

      const startBtn = document.getElementById('oiMaskStartBtn');
      const skipBtn = document.getElementById('oiMaskSkipBtn');
      const pageStartBtn = document.getElementById('start-button');

      startBtn && startBtn.addEventListener('click', ()=>{
        // éšè—è’™ç‰ˆï¼Œç„¶åè§¦å‘é¡µé¢çš„å¼€å§‹é€»è¾‘ï¼ˆè‹¥å­˜åœ¨ï¼‰
        hideMask();
        try{ if(typeof startFromStartPage === 'function') startFromStartPage(); }
        catch(e){}
      });

      skipBtn && skipBtn.addEventListener('click', ()=>{ hideMask(); });

      // å¦‚æœç”¨æˆ·åœ¨è’™ç‰ˆå­˜åœ¨æ—¶ç‚¹å‡»é¡µé¢åŸæœ‰çš„å¼€å§‹æŒ‰é’®ï¼ˆä¸åº”å¯è§ï¼‰ï¼Œç¡®ä¿ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œ
      pageStartBtn && pageStartBtn.addEventListener('click', ()=>{ hideMask(); });
    });
  })();
</script>
  <footer style="text-align:center;padding:12px 8px;color:#666;font-size:13px;border-top:1px solid #eee;margin-top:18px">
    ä½œè€… @Dreamers-seve Â· GitHub: <a href="https://github.com/seve42/OItrainer" target="_blank" rel="noopener">https://github.com/seve42/OItrainer</a>
  </footer>
  <!-- winter plan injection: center link inside footer (or fixed bottom if no footer) -->
  <script>
    // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ˜¯å¦éœ€è¦ä½¿ç”¨ç¹ä½“ä¸­æ–‡
    (function(){
      try{
        if(window.ChineseConverter && window.ChineseConverter.shouldUseTraditionalChinese()){
          // ç­‰å¾…DOMå®Œå…¨åŠ è½½åå†è½¬æ¢
          if(document.readyState === 'loading'){
            document.addEventListener('DOMContentLoaded', function(){
              setTimeout(function(){
                window.ChineseConverter.convertPageToTraditional();
              }, 100);
            });
          } else {
            setTimeout(function(){
              window.ChineseConverter.convertPageToTraditional();
            }, 100);
          }
        }
      }catch(e){ 
        console.error('ç¹ä½“ä¸­æ–‡è½¬æ¢å¤±è´¥:', e); 
      }
    })();
  </script>
  <div class="disclaimer" role="note" aria-label="å…è´£å£°æ˜" style="margin-top:8px;margin-bottom:18px;font-size:13px;color:#444;">
    å…è´£å£°æ˜ï¼šæœ¬æ¸¸æˆä¸ºè™šæ„çš„æ•™å­¦ä¸å¨±ä¹æ¨¡æ‹Ÿæ¸¸æˆã€‚æ¸¸æˆä¸­æ‰€å±•ç¤ºçš„è®­ç»ƒæ–¹å¼ã€æˆç»©ã€èµ„æºåˆ†é…ã€æ—¶é—´å®‰æ’å‡ä¸ºç©æ³•è®¾å®šã€‚æ‰€æœ‰äººåå‡ä¸ºéšæœºç”Ÿæˆï¼Œæ‰€æœ‰è®­ç»ƒç”¨é¢˜åº“å‡ä¸ºAIç”Ÿæˆï¼Œå’Œç°å®ä¸­å¯¹åº”å¹´ä»½æ¯”èµ›é¢˜ç›®å®Œå…¨ä¸ç›¸å…³ã€‚çœä»½å¼ºå¼±å’Œå„å›½é€‰æ‰‹æ°´å¹³å‡ä¸ºè™šæ„å’Œæ¸¸æˆè®¾å®šï¼Œå°æ¹¾çœã€é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒºå’Œæ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒºå‡ä¸ºä¸­å›½ä¸å¯åˆ†å‰²çš„ä¸€éƒ¨åˆ†ï¼ŒIOIæˆå‘˜å›½/åœ°åŒºä¸ºæˆªæ­¢2025å¹´10æœˆå®˜ç½‘æ ‡å‡†ã€‚
  </div>
</body>
</html>
